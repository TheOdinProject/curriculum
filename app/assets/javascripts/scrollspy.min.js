function escapeHash(t) { return t.replace(/(:|\.|\[|\]|,|=)/g, "\\$1") } function throttle(t, e, r) { var n, i, a, l = null, o = 0; r || (r = {}); var s = function () { o = r.leading === !1 ? 0 : getTime(), l = null, a = t.apply(n, i), n = i = null }; return function () { var c = getTime(); o || r.leading !== !1 || (o = c); var u = e - (c - o); return n = this, i = arguments, 0 >= u ? (clearTimeout(l), l = null, o = c, a = t.apply(n, i), n = i = null) : l || r.trailing === !1 || (l = setTimeout(s, u)), a } } $.extend($.easing, { def: "easeOutQuad", easeOutCubic: function (t) { return 1 - Math.pow(1 - t, 3) } }); var getTime = Date.now || function () { return (new Date).getTime() }; !function (t) { function e(e, r, n, i) { var l = t(); return t.each(a, function (t, a) { if (a.height() > 0) { var o = a.offset().top, s = a.offset().left, c = s + a.width(), u = o + a.height(), f = !(s > r || i > c || o > n || e > u); f && l.push(a) } }), l } function r(r) { ++s; var n = i.scrollTop(), a = i.scrollLeft(), o = a + i.width(), u = n + i.height(), f = e(n + c.top + r || 200, o + c.right, u + c.bottom, a + c.left); t.each(f, function (t, e) { var r = e.data("scrollSpy:ticks"); "number" != typeof r && e.triggerHandler("scrollSpy:enter"), e.data("scrollSpy:ticks", s) }), t.each(l, function (t, e) { var r = e.data("scrollSpy:ticks"); "number" == typeof r && r !== s && (e.triggerHandler("scrollSpy:exit"), e.data("scrollSpy:ticks", null)) }), l = f } function n() { i.trigger("scrollSpy:winSize") } var i = t(window), a = [], l = [], o = !1, s = 0, c = { top: 0, right: 0, bottom: 0, left: 0 }; t.scrollSpy = function (e, n) { var l = { throttle: 100, scrollOffset: 200, activeClass: "active", getActiveElement: function (t) { return 'a[href="#' + t + '"]' } }; n = t.extend(l, n); var s = []; e = t(e), e.each(function (e, r) { a.push(t(r)), t(r).data("scrollSpy:id", e), t('a[href="#' + t(r).attr("id") + '"]').click(function (e) { e.preventDefault(); var r = t(escapeHash(this.hash)).offset().top + 1; t("html, body").animate({ scrollTop: r - n.scrollOffset }, { duration: 400, queue: !1, easing: "easeOutCubic" }) }) }), c.top = n.offsetTop || 0, c.right = n.offsetRight || 0, c.bottom = n.offsetBottom || 0, c.left = n.offsetLeft || 0; var u = throttle(function () { r(n.scrollOffset) }, n.throttle || 100), f = function () { t(document).ready(u) }; return o || (i.on("scroll", f), i.on("resize", f), o = !0), setTimeout(f, 0), e.on("scrollSpy:enter", function () { s = t.grep(s, function (t) { return 0 != t.height() }); var e = t(this); if (s[0]) { var r = t(n.getActiveElement(s[0].attr("id"))); r.removeClass(n.activeClass), r.parent().prev().removeClass(n.activeClass), e.data("scrollSpy:id") < s[0].data("scrollSpy:id") ? s.unshift(t(this)) : s.push(t(this)) } else s.push(t(this)); var r = t(n.getActiveElement(s[0].attr("id"))); r.addClass(n.activeClass), r.parent().prev().addClass(n.activeClass) }), e.on("scrollSpy:exit", function () { if (s = t.grep(s, function (t) { return 0 != t.height() }), s[0]) { var e = t(n.getActiveElement(s[0].attr("id"))); e.removeClass(n.activeClass), e.parent().prev().removeClass(n.activeClass); var r = t(this); if (s = t.grep(s, function (t) { return t.attr("id") != r.attr("id") }), s[0]) { var e = t(n.getActiveElement(s[0].attr("id"))); e.addClass(n.activeClass), e.parent().prev().addClass(n.activeClass) } } }), e }, t.winSizeSpy = function (e) { return t.winSizeSpy = function () { return i }, e = e || { throttle: 100 }, i.on("resize", throttle(n, e.throttle || 100)) }, t.fn.scrollSpy = function (e) { return t.scrollSpy(t(this), e) } }(jQuery);